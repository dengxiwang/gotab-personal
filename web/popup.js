import{e,I as a,x as o,a2 as t,a0 as s,a3 as r,a4 as l,j as n,a5 as i,a6 as c,$ as d,a1 as f,a7 as u,E as m,ab as p,ac as h,y as x,ad as j,ae as g,B as b,H as y,af as C,ag as w,ah as v,ai as k,aj as F,T as S,ak as I,al as _,aa as N,a9 as D,am as T,an as O,ao as P,_ as L,ap as q,aq as R,G as U,d as V,s as z,R as B}from"./assets/requestIdleCallbackPolyfill-DVdtTnyH.js";import E from"./assets/myErrorPage-C9qdEWpj.js";import{u as W,F as A}from"./assets/index-HltPkFWT.js";import{l as G}from"./assets/assets-CmvcfQKP.js";import{R as M,a as H,b as Q,c as J}from"./assets/sortableJsUtils-Cmte6_W4.js";import{I as K}from"./assets/index-DtzU4EtU.js";import{R as $}from"./assets/CloudUploadOutlined-LoBWrexg.js";import{S as X}from"./assets/index-zo2gp33P.js";import{T as Y}from"./assets/index-ByhWaRvl.js";import{R as Z}from"./assets/QuestionCircleOutlined-DwFwqXJU.js";import{R as ee}from"./assets/RightSquareOutlined-CNc2yOfj.js";import"./assets/row-wzIeTg14.js";import"./assets/useBreakpoint-Bgav_ER7.js";import"./assets/mediaQueryUtil-DPPPwwPM.js";import"./assets/QuestionCircleOutlined-DSm95oJP.js";import"./assets/getAllowClear-BKx3CWLJ.js";import"./assets/Input-BTS9qamE.js";import"./assets/TextArea-DdWc5CpB.js";import"./assets/Overflow-Cf-e91fD.js";function ae(){return ae=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e},ae.apply(this,arguments)}const oe=(o,t)=>e.createElement(a,ae({},o,{ref:t,icon:ee})),te=e.forwardRef(oe);function se(){const a=o.c(4);let r,l,m,p;return a[0]===Symbol.for("react.memo_cache_sentinel")?(r=[],a[0]=r):r=a[0],e.useEffect(re,r),a[1]===Symbol.for("react.memo_cache_sentinel")?(l=t(s),a[1]=l):l=a[1],a[2]===Symbol.for("react.memo_cache_sentinel")?(m=n.jsx(i,{notification:{stack:{threshold:1}},children:n.jsx(c,{})}),a[2]=m):m=a[2],a[3]===Symbol.for("react.memo_cache_sentinel")?(p=n.jsx(d,{store:s,children:n.jsxs(f,{loading:null,persistor:l,children:[m,n.jsx(u,{children:n.jsx(ne,{})})]})}),a[3]=p):p=a[3],p}function re(){return le}function le(){r(),l()}const ne=()=>{var a;const t=o.c(47),r=m(),[l]=W(),[i,c]=e.useState(),{token:d}=p.useToken(),f=h(ie),u=h(ce),[V,z]=e.useState(!1),B="1"===localStorage.getItem("initOver"),E=h(de),ee=h(fe),ae=h(ue),oe=h(me),se=h(pe),re=h(he);let le;t[0]===Symbol.for("react.memo_cache_sentinel")?(le=[],t[0]=le):le=t[0];const[ne,Ce]=e.useState(le),[we,ve]=e.useState(!1);let ke,Fe;t[1]!==u?(Fe=u.map(xe),t[1]=u,t[2]=Fe):Fe=t[2],ke=Fe;const Se=ke;let Ie,_e,Ne,De,Te,Oe;if(t[3]!==l||t[4]!==i){let Be=function(e,a){C(0,Ce),T({url:v.getWebsiteInfo2,data:{url:e}}).then((e=>{200===e.code&&e.data&&(l.setFieldValue("icon",e.data.icon||""),l.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?ve(!0):ve(!1),setTimeout((()=>{c({...i,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||"#ffffff",fontColor:e.data.fontColor||"#000000"}),F(0,Ce)}),0))})).catch((()=>{a?We(a):Ee(e)}))},Ee=function(e){C(0,Ce),w({url:v.getWebsiteInfo,data:{url:e}}).then((e=>{200===e.code&&e.data&&(l.setFieldValue("icon",e.data.icon||""),l.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?ve(!0):ve(!1),setTimeout((()=>{c({...i,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||"#ffffff",fontColor:e.data.fontColor||"#000000"})}),0))})).finally((()=>{F(0,Ce)}))};async function We(e){C(0,Ce);const a=s.getState().home.getWebsiteInfoBy;if(L()&&"local"===a){const a=await q({todo:"uploadIcon",icon:e});if(!a||R(a)&&U(a))y.error("网站图标获取失败");else if(200===a.code&&a.data){const e=a.data.faviconUrl;l.setFieldValue("icon",e),ve(!1),c({...i,icon:e,backgroundColor:"#ffffff",fontColor:"#000000"})}F(0,Ce)}else T({url:v.uploadFavicon,data:{faviconUrl:e}}).then((e=>{200===e.code&&e.data&&(l.setFieldValue("icon",e.data.faviconUrl),ve(!1),c({...i,icon:e.data.faviconUrl,backgroundColor:"#ffffff",fontColor:"#000000"}))})).catch(je).finally((()=>{F(0,Ce)}))}Ie=function(){const e=document.location.protocol;"https:"!==e&&"http:"!==e?chrome.tabs.query({currentWindow:!0,active:!0},(function(e){if(0!==e.length){const a=e[0];if(!a.url)return void z(!0);z(!1),Be(a.url,a.favIconUrl),l.setFieldsValue({label:a.title,link:a.url}),c({...i,backgroundColor:"#ffffff",fontColor:"#000000",label:a.title,link:a.url})}})):z(!0)},t[3]=l,t[4]=i,t[5]=Ie}else Ie=t[5];t[6]!==Ie?(_e=()=>{B&&Ie()},t[6]=Ie,t[7]=_e):_e=t[7],t[8]===Symbol.for("react.memo_cache_sentinel")?(Ne=[],t[8]=Ne):Ne=t[8],e.useLayoutEffect(_e,Ne),t[9]!==r?(De=()=>{const e=document.location.protocol;if("https:"===e||"http:"===e)return;const a=(e,a)=>"updateListDataFromNewtab"===e.action?(r(D(e.payload)),!0):"updateFreeDragListDataFromNewtab"===e.action?(r(N(e.payload)),!0):void 0;return chrome.runtime.onMessage.addListener(a),()=>{chrome.runtime.onMessage.removeListener(a)}},t[9]=r,t[10]=De):De=t[10],t[11]===Symbol.for("react.memo_cache_sentinel")?(Te=[],t[11]=Te):Te=t[11],e.useEffect(De,Te),t[12]!==r||t[13]!==se||t[14]!==re||t[15]!==E||t[16]!==we||t[17]!==u||t[18]!==ae||t[19]!==i||t[20]!==ee||t[21]!==f?(Oe=function(e){const a=e.categoryId,o=s.getState().card.defaultCardSize,t=s.getState().card.defaultCardShowType;if(!ee&&ae){delete e.categoryId;const a={...i,...e,id:I(),size:o||"11",type:"link",showType:t||"icon",x:se,y:re,iconPadding:we?0:6},s=_(E).concat([a]);r(N(s)),y.success("卡片已添加至全屏自由拖拽");try{chrome.runtime.sendMessage({action:"updateFreeDragListDataFromPopup",payload:s},ge)}catch(l){}}else{const s={...i,...e,id:I(),size:o||"11",type:"link",showType:t||"icon",iconPadding:we?0:6},l=J(_(u),a,s);r(D(l)),y.success("卡片添加完成");try{chrome.runtime.sendMessage({action:"updateListDataFromPopup",payload:l},be)}catch(n){}}f&&T({url:v.pushData,data:{data:O(),timestamp:Date.now()},token:f}),C(2,Ce)},t[12]=r,t[13]=se,t[14]=re,t[15]=E,t[16]=we,t[17]=u,t[18]=ae,t[19]=i,t[20]=ee,t[21]=f,t[22]=Oe):Oe=t[22];const Pe=Oe;let Le,qe,Re,Ue,Ve,ze;return t[23]!==d.colorBgContainer?(Le={background:d.colorBgContainer},t[23]=d.colorBgContainer,t[24]=Le):Le=t[24],t[25]===Symbol.for("react.memo_cache_sentinel")?(qe=n.jsx("img",{src:G,className:"w-[24px] h-[24px]"}),t[25]=qe):qe=t[25],t[26]===Symbol.for("react.memo_cache_sentinel")?(Re=n.jsxs("div",{className:"h-12 flex px-6 items-center justify-between",children:[qe,n.jsx(b,{type:"link",className:"p-0",icon:n.jsx(te,{}),onClick:ye,children:"打开主页"})]}),Ue=n.jsx(P,{type:"horizontal",className:"m-0"}),t[26]=Re,t[27]=Ue):(Re=t[26],Ue=t[27]),t[28]!==oe||t[29]!==Se||t[30]!==l||t[31]!==Ie||t[32]!==we||t[33]!==V||t[34]!==u||t[35]!==ne||t[36]!==Pe||t[37]!==ae||t[38]!==i||t[39]!==ee||t[40]!==d.colorFillSecondary||t[41]!==d.colorTextDescription||t[42]!==f?(Ve=n.jsx("main",{className:"p-6 h-[442px] flex flex-col overflow-scroll",children:B?V?n.jsx(x,{className:"p-0 pb-6 m-auto",title:"网站类型不支持",subTitle:"无法正确获取网站信息"}):ne[2]?n.jsx(x,{status:"success",className:"p-0 pb-6 m-auto",title:"卡片添加成功",subTitle:"您已完成卡片添加，可选择关闭弹窗"}):n.jsxs(A,{labelCol:{flex:"82px"},form:l,initialValues:{categoryId:null==(a=u[oe])?void 0:a.id},layout:"horizontal",onFinish:Pe,onValuesChange:()=>{const e=l.getFieldsValue();c({...i,backgroundColor:"#ffffff",fontColor:"#000000",...e})},children:[n.jsx("div",{style:{backgroundColor:`${d.colorFillSecondary}`,borderRadius:"6px"},className:"mb-6 p-3 flex-center overflow-hidden",children:(null==i?void 0:i.icon)?n.jsx("div",{style:{backgroundColor:(null==i?void 0:i.backgroundColor)||"#ffffff",borderRadius:"12px",padding:we?0:6},className:"w-14 h-14 overflow-hidden flex-center",children:i.icon.startsWith("/default/")?n.jsx(H,{style:{fontSize:40,color:i.fontColor||"#000000"}}):n.jsx("img",{src:j(i.icon),alt:"",className:"w-full h-full"})}):n.jsx("p",{style:{color:d.colorTextDescription},className:"font-medium h-14 flex-center",children:"预览区域，等待图标配置"})}),n.jsx(A.Item,{required:!0,name:"link",rules:[{required:!0,message:"请输入卡片链接"}],children:n.jsx(K,{placeholder:"卡片链接",allowClear:!0,maxLength:512})}),n.jsx(A.Item,{name:"label",required:!0,rules:[{validator:(e,a)=>a&&""!==a?a.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:n.jsx(K,{placeholder:"卡片名称",allowClear:!0,maxLength:100})}),n.jsx(A.Item,{required:!0,name:"icon",rules:[{validator:(e,a)=>a&&""!==a?a&&a.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve():Promise.reject("请输入或上传网站图标")}],children:n.jsx(K,{addonBefore:n.jsx(S,{title:"设为本地默认",destroyOnHidden:!0,children:n.jsx(b,{type:"text",className:"rounded-none",icon:n.jsx(Q,{}),onClick:()=>{l.setFieldValue("icon","/default/IeOutlined"),l.validateFields({dirty:!0}),c({...i,icon:"/default/IeOutlined",backgroundColor:"#ffffff",fontColor:"#000000"})}})}),addonAfter:n.jsx(g,{disabled:!f,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(y.error("图标大小不能超过200KB！"),!1):(C(1,Ce),w({url:v.uploadIcon,token:f,data:k({file:e})}).then((e=>{200===e.code&&e.data&&(l.setFieldValue("icon",e.data.icon_url),l.validateFields({dirty:!0}),c({...i,icon:e.data.icon_url,backgroundColor:"#ffffff",fontColor:"#000000"}))})).finally((()=>{F(1,Ce)})),!1),children:n.jsx(b,{onClick:()=>{f||y.error("请您先完成登录/注册")},loading:ne[0],type:"text",className:"rounded-none",children:"上传",icon:n.jsx($,{})})}),placeholder:"图标地址（注：透明背景图标最佳）",allowClear:!0})}),n.jsx(A.Item,{required:!0,name:"categoryId",rules:[{required:!0,message:"请选择目标分组"}],children:n.jsx(X,{disabled:!ee&&ae,options:Se,allowClear:!0,placeholder:"目标分组"})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(b,{className:"w-full",disabled:ne[0]||ne[1]||ne[2],onClick:()=>{Ie()},children:"重新获取信息"}),n.jsx(b,{className:"w-full",type:"primary",htmlType:"submit",loading:ne[0]||ne[1],disabled:ne[2],children:ne[0]?"正在获取图标":ne[1]?"正在上传图标":"保存卡片信息"})]}),n.jsx(Y,{className:"w-full mt-3",icon:n.jsx(Z,{}),children:"更多配置请移步至主页编辑卡片，快捷方式暂不支持"})]}):n.jsx(x,{icon:n.jsx(M,{}),className:"p-0 pb-6 m-auto",title:"插件尚未初始化",subTitle:"请您先打开插件主页完成数据初始化"})}),t[28]=oe,t[29]=Se,t[30]=l,t[31]=Ie,t[32]=we,t[33]=V,t[34]=u,t[35]=ne,t[36]=Pe,t[37]=ae,t[38]=i,t[39]=ee,t[40]=d.colorFillSecondary,t[41]=d.colorTextDescription,t[42]=f,t[43]=Ve):Ve=t[43],t[44]!==Ve||t[45]!==Le?(ze=n.jsxs("div",{className:"w-[360px] h-[488px]",style:Le,children:[Re,Ue,Ve]}),t[44]=Ve,t[45]=Le,t[46]=ze):ze=t[46],ze};function ie(e){return e.user.token}function ce(e){return e.appData.listData}function de(e){return e.appData.freeDragListData}function fe(e){return e.swiper.showSwiper}function ue(e){return e.home.showFreeDrag}function me(e){return e.swiper.activeIndex}function pe(e){return e.home.freeDragGridX}function he(e){return e.home.freeDragGridY}function xe(e){return{label:e.label,value:e.id}}function je(){y.error("网站图标保存失败")}function ge(e){}function be(e){}function ye(){window.open(window.location.origin+"/newtab.html","_blank")}V.locale("zh-cn"),z(!1),B.createRoot(document.body).render(window.location.protocol.includes("http")?n.jsx(E,{}):n.jsx(se,{}));
