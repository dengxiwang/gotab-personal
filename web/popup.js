import{r as e,I as o,c as t,p as a,a as s,b as l,e as r,j as n,A as i,f as c,P as d,g as f,T as u,u as m,t as p,h,i as x,k as j,U as g,B as b,m as y,l as C,n as w,o as v,q as k,v as S,w as F,x as I,y as N,z as _,C as D,D as T,E as O,F as P,G as R,H as z,J as L,K as U,d as q,s as V,R as B}from"./assets/requestIdleCallbackPolyfill-CPe9lTcM.js";import E from"./assets/myErrorPage-xK6luVHV.js";import{u as M,F as W}from"./assets/index-CNjKVAUo.js";import{T as A}from"./assets/TextArea-vRztATkp.js";import{R as G,a as Q,g as H,b as J,c as K}from"./assets/sortableJsUtils-C3O1vwWi.js";import{l as X}from"./assets/assets-B8Bi78Vh.js";import{S as Y}from"./assets/index-BEfeEYtU.js";import{I as $}from"./assets/index-DSLgkNIi.js";import{R as Z}from"./assets/CloudUploadOutlined-DqCxDbvJ.js";import{S as ee}from"./assets/index-DrLdoldb.js";import{T as oe}from"./assets/index-BhwolGP3.js";import{R as te}from"./assets/QuestionCircleOutlined-CSI0LspI.js";import{R as ae}from"./assets/RightSquareOutlined-CNc2yOfj.js";import"./assets/row-Dt3IKLYa.js";import"./assets/useBreakpoint-DNPDEdTQ.js";import"./assets/mediaQueryUtil-DPPPwwPM.js";import"./assets/QuestionCircleOutlined-DSm95oJP.js";import"./assets/getAllowClear-C7x5Ty1a.js";import"./assets/handleButton-CkxSxX-D.js";import"./assets/fullSpin-JM6Mc24W.js";import"./assets/myModal-CrTTSpks.js";import"./assets/Input-eJls-qed.js";import"./assets/Overflow-DzHFI1dW.js";function se(){return se=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},se.apply(this,arguments)}const le=(t,a)=>e.createElement(o,se({},t,{ref:a,icon:ae})),re=e.forwardRef(le);function ne(){const o=t.c(4);let l,r,m,p;return o[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],o[0]=l):l=o[0],e.useEffect(ie,l),o[1]===Symbol.for("react.memo_cache_sentinel")?(r=a(s),o[1]=r):r=o[1],o[2]===Symbol.for("react.memo_cache_sentinel")?(m=n.jsx(i,{notification:{stack:{threshold:1}},children:n.jsx(c,{})}),o[2]=m):m=o[2],o[3]===Symbol.for("react.memo_cache_sentinel")?(p=n.jsx(d,{store:s,children:n.jsxs(f,{loading:null,persistor:r,children:[m,n.jsx(u,{children:n.jsx(de,{})})]})}),o[3]=p):p=o[3],p}function ie(){return ce}function ce(){l(),r()}const de=()=>{var o,a;const l=t.c(47),r=m(),[i]=M(),[c,d]=e.useState(),{token:f}=p.useToken(),u=h(fe),q=h(ue),[V,B]=e.useState(!1),E="1"===localStorage.getItem("initOver"),ae=h(me),se=h(pe),le=h(he),ne=h(xe),ie=h(je),ce=h(ge);let de;l[0]===Symbol.for("react.memo_cache_sentinel")?(de=[],l[0]=de):de=l[0];const[ke,Se]=e.useState(de),[Fe,Ie]=e.useState(!1);let Ne,_e;l[1]!==q?(_e=q.map(be),l[1]=q,l[2]=_e):_e=l[2],Ne=_e;const De=Ne;let Te,Oe,Pe,Re,ze,Le;if(l[3]!==i||l[4]!==c){let Ae=function(e,o){C(0,Se),T({url:v.getWebsiteInfo2,data:{url:e}}).then((e=>{200===e.code&&e.data&&(i.setFieldValue("icon",e.data.icon||""),i.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ie(!0):Ie(!1),setTimeout((()=>{d({...c,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||"#ffffff",fontColor:e.data.fontColor||"#000000"}),S(0,Se)}),0))})).catch((()=>{o?Qe(o):Ge(e)}))},Ge=function(e){C(0,Se),w({url:v.getWebsiteInfo,data:{url:e}}).then((e=>{200===e.code&&e.data&&(i.setFieldValue("icon",e.data.icon||""),i.validateFields({dirty:!0}),e.data.backgroundColor&&e.data.fontColor?Ie(!0):Ie(!1),setTimeout((()=>{d({...c,icon:e.data.icon||"",backgroundColor:e.data.backgroundColor||"#ffffff",fontColor:e.data.fontColor||"#000000"})}),0))})).finally((()=>{S(0,Se)}))};async function Qe(e){C(0,Se);const o=s.getState().home.getWebsiteInfoBy;if(R()&&"local"===o){const o=await z({todo:"uploadIcon",icon:e});if(!o||L(o)&&U(o))y.error("网站图标获取失败");else if(200===o.code&&o.data){const e=o.data.faviconUrl;i.setFieldValue("icon",e),Ie(!1),d({...c,icon:e,backgroundColor:"#ffffff",fontColor:"#000000"})}S(0,Se)}else T({url:v.uploadFavicon,data:{faviconUrl:e}}).then((e=>{200===e.code&&e.data&&(i.setFieldValue("icon",e.data.faviconUrl),Ie(!1),d({...c,icon:e.data.faviconUrl,backgroundColor:"#ffffff",fontColor:"#000000"}))})).catch(ye).finally((()=>{S(0,Se)}))}Te=function(){const e=document.location.protocol;"https:"!==e&&"http:"!==e?chrome.tabs.query({currentWindow:!0,active:!0},(function(e){if(0!==e.length){const o=e[0];if(!o.url)return void B(!0);B(!1),Ae(o.url,o.favIconUrl),i.setFieldsValue({label:o.title,link:o.url}),d({...c,backgroundColor:"#ffffff",fontColor:"#000000",label:o.title,link:o.url})}})):B(!0)},l[3]=i,l[4]=c,l[5]=Te}else Te=l[5];l[6]!==Te?(Oe=()=>{E&&Te()},l[6]=Te,l[7]=Oe):Oe=l[7],l[8]===Symbol.for("react.memo_cache_sentinel")?(Pe=[],l[8]=Pe):Pe=l[8],e.useLayoutEffect(Oe,Pe),l[9]!==r?(Re=()=>{const e=document.location.protocol;if("https:"===e||"http:"===e)return;const o=(e,o)=>"updateListDataFromNewtab"===e.action?(r(D(e.payload)),!0):"updateFreeDragListDataFromNewtab"===e.action?(r(_(e.payload)),!0):void 0;return chrome.runtime.onMessage.addListener(o),()=>{chrome.runtime.onMessage.removeListener(o)}},l[9]=r,l[10]=Re):Re=l[10],l[11]===Symbol.for("react.memo_cache_sentinel")?(ze=[],l[11]=ze):ze=l[11],e.useEffect(Re,ze),l[12]!==r||l[13]!==ie||l[14]!==ce||l[15]!==ae||l[16]!==Fe||l[17]!==q||l[18]!==le||l[19]!==c||l[20]!==se||l[21]!==u?(Le=function(e){const o=e.categoryId,t=s.getState().card.defaultCardSize,a=s.getState().card.defaultCardShowType;if(!se&&le){delete e.categoryId;const o={...c,...e,id:I(),size:t||"11",type:"link",showType:c.icon?a||"icon":"text",x:ie,y:ce,iconPadding:Fe?0:6},s=N(ae).concat([o]);r(_(s)),y.success("卡片已添加至全屏自由拖拽"),setTimeout((()=>{try{chrome.runtime.sendMessage({action:"updateFreeDragListDataFromPopup",payload:s},Ce)}catch(e){}}),0)}else{const s={...c,...e,id:I(),size:t||"11",type:"link",showType:c.icon?a||"icon":"text",iconPadding:Fe?0:6},l=K(N(q),o,s);r(D(l)),y.success("卡片添加完成"),setTimeout((()=>{try{chrome.runtime.sendMessage({action:"updateListDataFromPopup",payload:l},we)}catch(e){}}),0)}u&&T({url:v.pushData,data:{data:O(),timestamp:Date.now()},token:u}),C(2,Se)},l[12]=r,l[13]=ie,l[14]=ce,l[15]=ae,l[16]=Fe,l[17]=q,l[18]=le,l[19]=c,l[20]=se,l[21]=u,l[22]=Le):Le=l[22];const Ue=Le;let qe,Ve,Be,Ee,Me,We;return l[23]!==f.colorBgContainer?(qe={background:f.colorBgContainer},l[23]=f.colorBgContainer,l[24]=qe):qe=l[24],l[25]===Symbol.for("react.memo_cache_sentinel")?(Ve=n.jsx("img",{src:X,className:"w-[24px] h-[24px]"}),l[25]=Ve):Ve=l[25],l[26]===Symbol.for("react.memo_cache_sentinel")?(Be=n.jsxs("div",{className:"h-12 flex px-6 items-center justify-between",children:[Ve,n.jsx(b,{type:"link",className:"p-0",icon:n.jsx(re,{}),onClick:ve,children:"打开主页"})]}),Ee=n.jsx(P,{type:"horizontal",className:"m-0"}),l[26]=Be,l[27]=Ee):(Be=l[26],Ee=l[27]),l[28]!==ne||l[29]!==De||l[30]!==i||l[31]!==Te||l[32]!==Fe||l[33]!==V||l[34]!==q||l[35]!==ke||l[36]!==Ue||l[37]!==le||l[38]!==c||l[39]!==se||l[40]!==f.colorFillSecondary||l[41]!==f.colorTextDescription||l[42]!==u?(Me=n.jsx("main",{className:"p-6 h-[442px] flex flex-col overflow-scroll",children:E?V?n.jsx(x,{className:"p-0 pb-6 m-auto",title:"网站类型不支持",subTitle:"无法正确获取网站信息"}):ke[2]?n.jsx(x,{status:"success",className:"p-0 pb-6 m-auto",title:"卡片添加成功",subTitle:"您已完成卡片添加，可选择关闭弹窗"}):n.jsxs(W,{labelCol:{flex:"82px"},form:i,initialValues:{categoryId:null==(o=q[ne])?void 0:o.id},layout:"horizontal",onFinish:Ue,onValuesChange:()=>{const e=i.getFieldsValue();d({...c,backgroundColor:"#ffffff",fontColor:"#000000",...e})},children:[n.jsx("div",{style:{backgroundColor:`${f.colorFillSecondary}`,borderRadius:"6px"},className:"mb-6 p-3 flex-center overflow-hidden",children:(null==c?void 0:c.label)||(null==c?void 0:c.icon)?n.jsx("div",{style:{backgroundColor:(null==c?void 0:c.backgroundColor)||"#ffffff",borderRadius:"12px",padding:Fe?0:6},className:"w-14 h-14 overflow-hidden flex-center",children:ke[0]||ke[1]?n.jsx(Y,{spinning:!0}):c.icon?(null==(a=c.icon)?void 0:a.startsWith("/default/"))?n.jsx(Q,{style:{fontSize:40,color:c.fontColor||"#000000"}}):n.jsx("img",{src:j(c.icon),alt:"",className:"w-full h-full"}):n.jsx("p",{style:{fontSize:H(c.label)>2?"14px":"18px"},className:"line-clamp-2 font-bold text-center w-full pt-[2px] break-words whitespace-break-spaces",children:c.label})}):n.jsx("p",{style:{color:f.colorTextDescription},className:"font-medium h-14 flex-center",children:"预览区域，等待图标配置"})}),n.jsx(W.Item,{required:!0,name:"link",rules:[{required:!0,message:"请输入卡片链接"}],children:n.jsx($,{placeholder:"卡片链接",allowClear:!0,maxLength:512})}),n.jsx(W.Item,{name:"label",required:!0,rules:[{validator:(e,o)=>o&&""!==o?o.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:n.jsx(A,{placeholder:"卡片名称",allowClear:!0,maxLength:100,autoSize:{minRows:1,maxRows:1}})}),n.jsx(W.Item,{required:!0,name:"icon",rules:[{validator:(e,o)=>o&&""!==o&&o&&o.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve()}],children:n.jsx($,{addonBefore:n.jsx(F,{title:"设为本地默认",destroyOnHidden:!0,children:n.jsx(b,{type:"text",className:"rounded-none",icon:n.jsx(J,{}),onClick:()=>{i.setFieldValue("icon","/default/IeOutlined"),i.validateFields({dirty:!0}),d({...c,icon:"/default/IeOutlined",backgroundColor:"#ffffff",fontColor:"#000000"})}})}),addonAfter:n.jsx(g,{disabled:!u,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(y.error("图标大小不能超过200KB！"),!1):(C(1,Se),w({url:v.uploadIcon,token:u,data:k({file:e})}).then((e=>{200===e.code&&e.data&&(i.setFieldValue("icon",e.data.icon_url),i.validateFields({dirty:!0}),d({...c,icon:e.data.icon_url,backgroundColor:"#ffffff",fontColor:"#000000"}))})).finally((()=>{S(1,Se)})),!1),children:n.jsx(b,{onClick:()=>{u||y.error("请您先完成登录/注册")},loading:ke[0],type:"text",className:"rounded-none",children:"上传",icon:n.jsx(Z,{})})}),placeholder:"图标地址（注：透明背景图标最佳）",allowClear:!0})}),n.jsx(W.Item,{required:!0,name:"categoryId",rules:[{required:!0,message:"请选择目标分组"}],children:n.jsx(ee,{disabled:!se&&le,options:De,allowClear:!0,placeholder:"目标分组"})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(b,{className:"w-full",disabled:ke[0]||ke[1]||ke[2],onClick:()=>{Te()},children:"重新获取信息"}),n.jsx(b,{className:"w-full",type:"primary",htmlType:"submit",loading:ke[0]||ke[1],disabled:ke[2],children:ke[0]?"正在获取图标":ke[1]?"正在上传图标":"保存卡片信息"})]}),n.jsx(oe,{className:"w-full mt-3",icon:n.jsx(te,{}),children:"更多配置请移步至主页编辑卡片，快捷方式暂不支持"})]}):n.jsx(x,{icon:n.jsx(G,{}),className:"p-0 pb-6 m-auto",title:"插件尚未初始化",subTitle:"请您先打开插件主页完成数据初始化"})}),l[28]=ne,l[29]=De,l[30]=i,l[31]=Te,l[32]=Fe,l[33]=V,l[34]=q,l[35]=ke,l[36]=Ue,l[37]=le,l[38]=c,l[39]=se,l[40]=f.colorFillSecondary,l[41]=f.colorTextDescription,l[42]=u,l[43]=Me):Me=l[43],l[44]!==Me||l[45]!==qe?(We=n.jsxs("div",{className:"w-[360px] h-[488px]",style:qe,children:[Be,Ee,Me]}),l[44]=Me,l[45]=qe,l[46]=We):We=l[46],We};function fe(e){return e.user.token}function ue(e){return e.appData.listData}function me(e){return e.appData.freeDragListData}function pe(e){return e.swiper.showSwiper}function he(e){return e.home.showFreeDrag}function xe(e){return e.swiper.activeIndex}function je(e){return e.home.freeDragGridX}function ge(e){return e.home.freeDragGridY}function be(e){return{label:e.label,value:e.id}}function ye(){y.error("网站图标保存失败")}function Ce(e){}function we(e){}function ve(){window.open(window.location.origin+"/newtab.html","_blank")}q.locale("zh-cn"),V(!1),B.createRoot(document.body).render(window.location.protocol.includes("http")?n.jsx(E,{}):n.jsx(ne,{}));
