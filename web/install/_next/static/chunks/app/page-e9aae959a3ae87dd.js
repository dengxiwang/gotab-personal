(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{544:(e,l,r)=>{Promise.resolve().then(r.bind(r,7848))},6090:(e,l,r)=>{"use strict";let s;r.d(l,{Ay:()=>t,iU:()=>s});var a=r(2303);let t=()=>{let e=a.A.useApp();return s=e.message,e.modal,e.notification,null}},7848:(e,l,r)=>{"use strict";r.r(l),r.d(l,{default:()=>j});var s=r(2986),a=r(6090),t=r(796),o=r(9188),i=r(2282),n=r(9620),d=r(6471),m=r(34),c=r(9675),u=r(2630),h=r(9628),p=r(6354);function x(e){return"string"==typeof e&&/^https?:\/\/.+/i.test(e)}function j(){var e;let{token:l}=o.A.useToken(),[r,j]=(0,p.useState)(0),[A]=(0,h.A)(),[f,b]=(0,p.useState)(!1),[w,v]=(0,p.useState)([]),g=[{title:"基础信息",content:(0,s.jsxs)(i.A,{autoComplete:"off",labelCol:{flex:"82px"},variant:"filled",form:A,children:[(0,s.jsx)(i.A.Item,{required:!0,rules:[{required:!0,message:"请输入网站标题"}],label:"网站名称",name:"webTitle",children:(0,s.jsx)(n.A,{placeholder:"网站标题",allowClear:!0})}),(0,s.jsx)(i.A.Item,{required:!0,rules:[{validator:(e,l)=>""!==l&&l?/^[a-zA-Z]/.test(l)?/^[a-zA-Z][a-zA-Z0-9_-]*$/.test(l)?l.length<3||l.length>20?Promise.reject(Error("管理账号长度必须在3到20位之间")):Promise.resolve():Promise.reject(Error("管理账号只能包含字母、数字、下划线或短横线")):Promise.reject(Error("管理账号必须以字母开头")):Promise.reject(Error("请输入管理员账号"))}],label:"管理账号",name:"username",children:(0,s.jsx)(n.A,{placeholder:"管理员账号",allowClear:!0})}),(0,s.jsx)(i.A.Item,{required:!0,rules:[{validator:(e,l)=>""!==l&&l?/^[a-zA-Z0-9_\-!@#$%^&*()+={}[\]:;"'<>.,?/~`|]+$/.test(l)?l.length<6||l.length>32?Promise.reject(Error("管理员密码长度必须在6到32位之间")):Promise.resolve():Promise.reject(Error("管理员密码只能包含字母、数字、下划线、短横线以及其他常用特殊字符")):Promise.reject(Error("请输入管理员密码"))}],label:"管理密码",name:"password",children:(0,s.jsx)(n.A.Password,{autoComplete:"new-password",placeholder:"管理员密码",allowClear:!0})}),(0,s.jsx)(i.A.Item,{required:!0,rules:[{required:!0}],label:"服务地址",name:"serverUrl",children:(0,s.jsx)(n.A,{placeholder:"服务端地址，如https://web.gotab.cn或http://192.168.1.100:8080"})})]})},{title:"Mysql数据库",content:(0,s.jsxs)(i.A,{autoComplete:"off",labelCol:{flex:"100px"},variant:"filled",form:A,children:[(0,s.jsx)(i.A.Item,{required:!0,rules:[{required:!0,message:"请输入数据库地址"},{pattern:/^[a-zA-Z0-9.:\/_-]+$/,message:"请输入有效的数据库地址"}],label:"数据库地址",name:"mysqlHost",children:(0,s.jsx)(n.A,{placeholder:"数据库地址",allowClear:!0})}),(0,s.jsx)(i.A.Item,{required:!0,rules:[{required:!0,message:"请输入数据库端口"},()=>({validator:(e,l)=>!l||l>=1&&l<=65535?Promise.resolve():Promise.reject(Error("请输入有效端口号（1-65535）"))})],label:"数据库端口",name:"mysqlPort",children:(0,s.jsx)(d.A,{min:1,max:65535,precision:0,placeholder:"端口"})}),(0,s.jsx)(i.A.Item,{required:!0,rules:[{required:!0}],label:"用户名",name:"mysqlUsername",children:(0,s.jsx)(n.A,{placeholder:"数据库用户名",allowClear:!0})}),(0,s.jsx)(i.A.Item,{required:!0,rules:[{required:!0}],label:"密码",name:"mysqlPassword",children:(0,s.jsx)(n.A.Password,{autoComplete:"new-password",placeholder:"数据库密码",allowClear:!0})}),(0,s.jsx)(i.A.Item,{required:!0,rules:[{required:!0}],label:"数据库名",name:"database",children:(0,s.jsx)(n.A,{placeholder:"数据库名称",allowClear:!0})})]})},{title:"邮件服务",content:(0,s.jsxs)(i.A,{autoComplete:"off",labelCol:{flex:"100px"},variant:"filled",form:A,children:[(0,s.jsx)(i.A.Item,{label:"SMTP地址",name:"smtpHost",children:(0,s.jsx)(n.A,{placeholder:"SMTP服务器地址",allowClear:!0})}),(0,s.jsx)(i.A.Item,{label:"加密方式",name:"encryption",children:(0,s.jsx)(m.A,{placeholder:"加密方式",options:[{value:"None",label:"不加密"},{value:"SSL/TLS",label:"SSL/TLS"},{value:"STARTTLS",label:"STARTTLS"}]})}),(0,s.jsx)(i.A.Item,{label:"SMTP端口",name:"smtpPort",children:(0,s.jsx)(d.A,{min:1,max:65535,precision:0,placeholder:"端口"})}),(0,s.jsx)(i.A.Item,{name:"smtpUsername",label:"用户名",children:(0,s.jsx)(n.A,{placeholder:"用户名",allowClear:!0})}),(0,s.jsx)(i.A.Item,{name:"smtpPassword",label:"密码",children:(0,s.jsx)(n.A.Password,{autoComplete:"new-password",placeholder:"密码",allowClear:!0})})]})}],y=()=>{let e=A.getFieldsValue();if(e.serverUrl&&!x(e.serverUrl))return void a.iU.error("服务地址必须以http或https开头");A.validateFields().then(()=>{v(e=>{let l=[...e];return l[r]=A.getFieldsValue(),l}),j(r+1)})},C=()=>{j(r-1)},P=g.map(e=>e&&{key:e.title,title:e.title}),q={lineHeight:"260px",color:l.colorTextTertiary,borderRadius:l.borderRadiusLG,border:"1px dashed ".concat(l.colorBorder),marginTop:16};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"p-6 pb-16 m-auto max-w-2xl w-full flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3 m-auto p-6 items-center",children:[(0,s.jsx)(t.A,{style:{fontSize:"36px"}}),(0,s.jsx)("p",{className:" font-semibold text-xl",children:"初始化配置"})]}),(0,s.jsx)("div",{className:"px-6",children:(0,s.jsx)(c.A,{current:r,items:P})}),(0,s.jsxs)("div",{style:q,className:" p-6",children:[null==(e=g[r])?void 0:e.content,(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap justify-center overflow-hidden",children:[r>0&&(0,s.jsx)(u.Ay,{className:" min-w-36",style:{margin:"0 8px"},onClick:()=>C(),children:"上一步"}),r<g.length-1&&(0,s.jsx)(u.Ay,{className:" min-w-36",type:"primary",onClick:()=>y(),children:"下一步"}),r===g.length-1&&(0,s.jsx)(u.Ay,{className:" min-w-36",type:"primary",onClick:()=>(function(){let e=function(e,l){let r={};return e.forEach(e=>{Object.assign(r,e)}),Object.assign(r,l),r}(w,A.getFieldsValue());if(e.serverUrl&&!x(e.serverUrl))return void a.iU.error("服务地址必须以http或https开头");b(!0),fetch("/api/initToml",{method:"POST",body:JSON.stringify(e)}).then(e=>{e.json().then(e=>{200===e.code?(a.iU.success(e.msg),setTimeout(()=>{window.location.reload()},1e3)):a.iU.error(e.msg)}).catch(e=>{a.iU.error(e.message)})}).catch(e=>{a.iU.error(e.message)}).finally(()=>{b(!1)})})(),loading:f,children:"完成配置"})]})]})]})})}}},e=>{var l=l=>e(e.s=l);e.O(0,[303,500,832,389,358],()=>l(544)),_N_E=e.O()}]);