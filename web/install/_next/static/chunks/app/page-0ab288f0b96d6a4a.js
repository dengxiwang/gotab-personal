(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2532:(e,l,r)=>{"use strict";r.r(l),r.d(l,{default:()=>A});var s=r(7748),a=r(5350),t=r(7025),o=r(7777),i=r(5050),n=r(9165),c=r(5428),d=r(9404),m=r(2762),u=r(4906),p=r(8029),h=r(5704),x=r(40);function j(e){return"string"==typeof e&&/^https?:\/\/.+/i.test(e)}function A(){var e;let{token:l}=i.A.useToken(),[r,A]=(0,x.useState)(0),[f]=(0,h.A)(),[w,b]=(0,x.useState)(!1),[v,y]=(0,x.useState)([]);(0,x.useEffect)(()=>{let{protocol:e,hostname:l,port:r}=window.location,s=l;"localhost"===s&&(s="127.0.0.1");let a="".concat(e,"//").concat(s);r&&!["80","443"].includes(r)&&(a+=":".concat(r)),f.setFieldValue("serverUrl",a)},[]);let g=[{title:"基础信息",content:(0,s.jsxs)(n.A,{autoComplete:"off",labelCol:{flex:"82px"},variant:"filled",form:f,children:[(0,s.jsx)(n.A.Item,{required:!0,rules:[{required:!0,message:"请输入网站标题"}],label:"网站名称",name:"webTitle",children:(0,s.jsx)(c.A,{placeholder:"网站标题",allowClear:!0})}),(0,s.jsx)(n.A.Item,{required:!0,rules:[{validator:(e,l)=>""!==l&&l?/^[a-zA-Z]/.test(l)?/^[a-zA-Z][a-zA-Z0-9_-]*$/.test(l)?l.length<3||l.length>20?Promise.reject(Error("管理账号长度必须在3到20位之间")):Promise.resolve():Promise.reject(Error("管理账号只能包含字母、数字、下划线或短横线")):Promise.reject(Error("管理账号必须以字母开头")):Promise.reject(Error("请输入管理员账号"))}],label:"管理账号",name:"username",children:(0,s.jsx)(c.A,{placeholder:"管理员账号",allowClear:!0})}),(0,s.jsx)(n.A.Item,{required:!0,rules:[{validator:(e,l)=>""!==l&&l?/^[a-zA-Z0-9_\-!@#$%^&*()+={}[\]:;"'<>.,?/~`|]+$/.test(l)?l.length<6||l.length>32?Promise.reject(Error("管理员密码长度必须在6到32位之间")):Promise.resolve():Promise.reject(Error("管理员密码只能包含字母、数字、下划线、短横线以及其他常用特殊字符")):Promise.reject(Error("请输入管理员密码"))}],label:"管理密码",name:"password",children:(0,s.jsx)(c.A.Password,{autoComplete:"new-password",placeholder:"管理员密码",allowClear:!0})}),(0,s.jsx)(n.A.Item,{required:!0,rules:[{required:!0}],label:"服务地址",name:"serverUrl",children:(0,s.jsx)(c.A,{placeholder:"服务端地址，如https://web.gotab.cn或http://192.168.1.100:8080",allowClear:!0})})]})},{title:"Mysql数据库",content:(0,s.jsxs)(n.A,{autoComplete:"off",labelCol:{flex:"100px"},variant:"filled",form:f,children:[(0,s.jsx)(n.A.Item,{required:!0,rules:[{required:!0,message:"请输入数据库地址"},{pattern:/^[a-zA-Z0-9.:\/_-]+$/,message:"请输入有效的数据库地址"}],label:"数据库地址",name:"mysqlHost",children:(0,s.jsx)(c.A,{placeholder:"数据库地址",allowClear:!0})}),(0,s.jsx)(n.A.Item,{required:!0,rules:[{required:!0,message:"请输入数据库端口"},()=>({validator:(e,l)=>!l||l>=1&&l<=65535?Promise.resolve():Promise.reject(Error("请输入有效端口号（1-65535）"))})],label:"数据库端口",name:"mysqlPort",children:(0,s.jsx)(d.A,{min:1,max:65535,precision:0,className:"w-full max-w-32",placeholder:"端口",addonAfter:(0,s.jsx)(t.A,{className:"opacity-35 hover:opacity-75 cursor-pointer",style:{transition:"all 0.3s ease-in-out"},onClick:()=>{f.setFieldValue("mysqlPort",null)}})})}),(0,s.jsx)(n.A.Item,{required:!0,rules:[{required:!0}],label:"用户名",name:"mysqlUsername",children:(0,s.jsx)(c.A,{placeholder:"数据库用户名",allowClear:!0})}),(0,s.jsx)(n.A.Item,{required:!0,rules:[{required:!0}],label:"密码",name:"mysqlPassword",children:(0,s.jsx)(c.A.Password,{autoComplete:"new-password",placeholder:"数据库密码",allowClear:!0})}),(0,s.jsx)(n.A.Item,{required:!0,rules:[{required:!0}],label:"数据库名",name:"database",children:(0,s.jsx)(c.A,{placeholder:"数据库名称",allowClear:!0})})]})},{title:"邮件服务",content:(0,s.jsxs)(n.A,{autoComplete:"off",labelCol:{flex:"100px"},variant:"filled",form:f,children:[(0,s.jsx)(n.A.Item,{label:"SMTP地址",name:"smtpHost",children:(0,s.jsx)(c.A,{placeholder:"SMTP服务器地址",allowClear:!0})}),(0,s.jsx)(n.A.Item,{label:"加密方式",name:"encryption",children:(0,s.jsx)(m.A,{placeholder:"加密方式",options:[{value:"None",label:"不加密"},{value:"SSL/TLS",label:"SSL/TLS"},{value:"STARTTLS",label:"STARTTLS"}],allowClear:!0})}),(0,s.jsx)(n.A.Item,{label:"SMTP端口",name:"smtpPort",children:(0,s.jsx)(d.A,{min:1,max:65535,precision:0,placeholder:"端口",addonAfter:(0,s.jsx)(t.A,{className:"opacity-35 hover:opacity-75 cursor-pointer",style:{transition:"all 0.3s ease-in-out"},onClick:()=>{f.setFieldValue("smtpPort",null)}})})}),(0,s.jsx)(n.A.Item,{name:"smtpUsername",label:"用户名",children:(0,s.jsx)(c.A,{placeholder:"用户名",allowClear:!0})}),(0,s.jsx)(n.A.Item,{name:"smtpPassword",label:"密码",children:(0,s.jsx)(c.A.Password,{autoComplete:"new-password",placeholder:"密码",allowClear:!0})})]})}],C=()=>{let e=f.getFieldsValue();if(e.serverUrl&&!j(e.serverUrl))return void a.iU.error("服务地址必须以http或https开头");f.validateFields().then(()=>{y(e=>{let l=[...e];return l[r]=f.getFieldsValue(),l}),A(r+1)})},P=()=>{A(r-1)},q=g.map(e=>e&&{key:e.title,title:e.title}),S={lineHeight:"260px",color:l.colorTextTertiary,borderRadius:l.borderRadiusLG,border:"1px dashed ".concat(l.colorBorder),marginTop:16};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"p-6 pb-16 m-auto max-w-2xl w-full flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3 m-auto p-6 items-center",children:[(0,s.jsx)(o.A,{style:{fontSize:"36px"}}),(0,s.jsx)("p",{className:" font-semibold text-xl",children:"初始化配置"})]}),(0,s.jsx)("div",{className:"px-6",children:(0,s.jsx)(u.A,{current:r,items:q})}),(0,s.jsxs)("div",{style:S,className:" p-6",children:[null==(e=g[r])?void 0:e.content,(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap justify-center overflow-hidden",children:[r>0&&(0,s.jsx)(p.Ay,{className:" min-w-36",style:{margin:"0 8px"},onClick:()=>P(),children:"上一步"}),r<g.length-1&&(0,s.jsx)(p.Ay,{className:" min-w-36",type:"primary",onClick:()=>C(),children:"下一步"}),r===g.length-1&&(0,s.jsx)(p.Ay,{className:" min-w-36",type:"primary",onClick:()=>(function(){let e=function(e,l){let r={};return e.forEach(e=>{Object.assign(r,e)}),Object.assign(r,l),r}(v,f.getFieldsValue());if(e.serverUrl&&!j(e.serverUrl))return void a.iU.error("服务地址必须以http或https开头");b(!0),fetch("/api/initToml",{method:"POST",body:JSON.stringify(e)}).then(e=>{e.json().then(e=>{200===e.code?(a.iU.success(e.msg),setTimeout(()=>{window.location.reload()},1e3)):a.iU.error(e.msg)}).catch(e=>{a.iU.error(e.message)})}).catch(e=>{a.iU.error(e.message)}).finally(()=>{b(!1)})})(),loading:w,children:"完成配置"})]})]})]})})}},5350:(e,l,r)=>{"use strict";let s;r.d(l,{Ay:()=>t,iU:()=>s});var a=r(3835);let t=()=>{let e=a.A.useApp();return s=e.message,e.modal,e.notification,null}},9722:(e,l,r)=>{Promise.resolve().then(r.bind(r,2532))}},e=>{var l=l=>e(e.s=l);e.O(0,[835,614,831,51,358],()=>l(9722)),_N_E=e.O()}]);