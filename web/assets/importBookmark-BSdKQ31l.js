import{E as e,ac as a,e as l,ab as s,a0 as t,al as i,ak as o,aa as r,H as n,a9 as d,a8 as c,ax as m,_ as u,ap as p,j as x,B as j,cv as f,cf as h,af as g,cw as b,aq as w,G as C,aj as v,ag as k,ah as y,ae as F,ai as I,T as S,ao as T,cp as P}from"./main-CD0zUXTL.js";import{u as N,F as V}from"./index-CPWVZU1v.js";import{n as L,o as q,S as O,l as D,p as B}from"./homePage-CIuml-fn.js";import{c as z,b as U}from"./sortableJsUtils-BX0Sk2cn.js";import{I as A}from"./index-CS9jTL4o.js";import{S as R}from"./index-BxI9IZHD.js";import{a as H}from"./useFresh-C0ydC2D3.js";import{R as M}from"./CloudUploadOutlined-BinTKSYW.js";import{C as E}from"./ColorPicker-CnU4NOEh.js";import{T as W}from"./index-B1ITt1Ri.js";import"./row-D5tVqh3E.js";import"./useBreakpoint-BfXG9374.js";import"./mediaQueryUtil-DPPPwwPM.js";import"./QuestionCircleOutlined-DSm95oJP.js";import"./main-FlqzP-we.js";import"./fullSpin-DETvvkaa.js";import"./index-CYN5EPmR.js";import"./myDrawer2-XUwb6Rbf.js";import"./handleButton-CAPCMeRL.js";import"./myModal-BS4Tmmgl.js";import"./submitForInclusion-BSkUuvHS.js";import"./assets-CmvcfQKP.js";import"./iconBase-Csl-8KPx.js";import"./index-DRF0O40K.js";import"./MailOutlined-Cl2XolnV.js";import"./Overflow-Dth-jHIb.js";import"./index-Bn4721qN.js";import"./LeftOutlined-D9Sp279J.js";import"./PlusOutlined-1TyBi2cw.js";import"./SearchOutlined-DoicOXKf.js";import"./Input-DAmAjPDT.js";import"./getAllowClear-CZO_kcqc.js";import"./spinLoading-BG3t2iPD.js";import"./LikeFilled-DDFTNZB0.js";import"./QuestionCircleOutlined-DhwgGFOD.js";import"./ReloadOutlined-B00s2TmV.js";import"./LeftOutlined-Bq_4Sdq4.js";import"./styleChecker-D6YSF6t4.js";import"./TextArea-CFMh1Qsp.js";import"./sortable.esm-BbtDOPOV.js";import"./addRecommendAppForm-Ci7F6SrV.js";import"./UserOutlined-BiCaaNud.js";import"./markdownContent-CJelBs64.js";import"./index-XW6SjtyU.js";import"./index-Dk4rmiqF.js";const{useToken:_}=s,{TextArea:G}=A;function Q(s){const{item:Q}=s,J=e(),K=a((e=>e.appData.listData)),$=a((e=>e.swiper.showSwiper)),Y=a((e=>e.home.showFreeDrag)),[Z,X]=l.useState(null),[ee]=N(),{token:ae}=_(),[le,se]=l.useState(!1),[te,ie]=l.useState("icon"),[oe,re]=l.useState(Q||{}),ne=a((e=>e.user.token)),de=a((e=>e.swiper.activeIndex)),ce=a((e=>e.stateUtils.mySwiper)),me=a((e=>e.card.defaultCardSize)),ue=a((e=>e.card.defaultCardShowType)),pe=K[de].id,xe=l.useMemo((()=>K.map((e=>({label:e.label,value:e.id})))),[K]),je=l.useCallback((e=>{if(Y&&!$){const a=t.getState().appData.freeDragListData,l=i(a).concat([{id:o(),type:"link",...e}]);J(r(l)),n.success("卡片已添加至自由拖拽区域")}else{const a=t.getState().appData.listData,l=z(i(a),pe,{id:o(),type:"link",...e});J(d(l)),n.success("卡片添加完成")}c.hide(m)}),[pe,Z]),fe=l.useRef(null);l.useEffect((()=>()=>{fe.current&&clearTimeout(fe.current),fe.current=null}),[]);const[he,ge]=l.useState([]);return l.useEffect((()=>()=>{u()&&p({todo:"getWebsiteInfo",url:"cancel"})}),[]),x.jsx("div",{className:"flex flex-wrap gap-3 justify-center",children:x.jsxs("div",{className:"flex-auto max-w-[640px]",children:[x.jsx(L,{showItem:oe}),x.jsxs(V,{id:"add-edit-link-card",form:ee,variant:"filled",autoComplete:"off",labelCol:{flex:"84px"},initialValues:{...Q,link:Q.url,label:Q.title,size:me||"11",openTarget:"globalSet",showType:ue||"icon",backgroundColor:"#ffffff",fontColor:"#000000",iconPadding:0},onFinish:e=>{e.icon&&(e.icon=f(e.icon,"https://")),e.link&&(e.link=f(e.link,"https://")),e.internalLink&&(e.internalLink=f(e.internalLink,"http://")),je(e)},onValuesChange:e=>{e.showType&&ie(e.showType),e.backgroundColor&&ee.setFieldValue("fontColor",P(e.backgroundColor)),fe.current&&clearTimeout(fe.current),fe.current=setTimeout((()=>{re(ee.getFieldsValue())}),0)},children:[x.jsxs("div",{className:"flex gap-3 items-end",children:[x.jsx(V.Item,{className:"flex-1",label:"卡片链接",name:"link",required:!0,rules:[{required:!0,message:"请输入卡片链接"}],children:x.jsx(A,{maxLength:512,placeholder:"请输入卡片链接，默认安全链接（https://）",allowClear:!0,addonAfter:x.jsx(j,{onClick:async()=>{const e=ee.getFieldValue("link");if(!e)return void n.error("请输入卡片链接");const a=f(e,"https://");if(!h(a))return void n.error("请输入正确的卡片链接");const l=t.getState().home.getWebsiteInfoBy;if(u()&&"local"===l){g(1,ge);const e=await p({todo:"getWebsiteInfo",url:a}),l=(new DOMParser).parseFromString(e,"text/html"),s=b(l,a);if(w(e)&&C(e)||""===s.title)return n.error("获取网站信息失败"),void v(1,ge);let t="",i=!1;if(s.icon){const e=await p({todo:"uploadIcon",icon:s.icon});!e||w(e)&&C(e)?(i=!0,n.error("网站图标获取失败")):200===e.code&&e.data&&(t=e.data.faviconUrl)}ee.setFieldsValue({label:s.title,icon:t,backgroundColor:"#ffffff",fontColor:"#000000",description:s.description,iconPadding:6}),ee.validateFields({dirty:!0}),re(ee.getFieldsValue()),i||n.success("获取网站信息完成"),v(1,ge)}else g(1,ge),k({url:y.getWebsiteInfo,data:{url:a}}).then((e=>{200===e.code&&e.data&&(ee.setFieldValue("label",e.data.title||""),ee.setFieldValue("icon",e.data.icon||""),ee.setFieldValue("backgroundColor",e.data.backgroundColor||"#ffffff"),ee.setFieldValue("fontColor",e.data.fontColor||"#000000"),ee.setFieldValue("description",e.data.description||""),e.data.backgroundColor&&e.data.fontColor||ee.setFieldValue("iconPadding",6),ee.validateFields({dirty:!0}),setTimeout((()=>{re(ee.getFieldsValue())}),0))})).finally((()=>{v(1,ge)}))},loading:he[1],type:"text",className:"rounded-none",children:"获取信息",icon:x.jsx(q,{})})})}),x.jsx("div",{className:"flex items-center h-8 mb-6",children:x.jsx(O,{checked:le,checkedChildren:"内网",onChange:e=>{se(e)},unCheckedChildren:"常规"})})]}),x.jsx(V.Item,{label:"内网链接",required:!0,rules:[{required:le,message:"请输入内网链接"}],name:"internalLink",style:{display:le?"":"none"},children:x.jsx(A,{placeholder:"请输入内网链接，默认普通链接（http://）",allowClear:!0,maxLength:512})}),x.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[x.jsx(V.Item,{label:"卡片名称",name:"label",required:!0,rules:[{validator:(e,a)=>a&&""!==a?a.length>100?Promise.reject("卡片名称不能超过100个字符"):Promise.resolve():Promise.reject("请输入卡片名称")}],children:x.jsx(A,{placeholder:"请输入卡片名称",allowClear:!0,maxLength:100})}),"icon-h"===te||"icon-v"===te?x.jsx(V.Item,{label:"卡片内标题",name:"innerlabel",rules:[{validator:(e,a)=>a&&a.length>100?Promise.reject("卡片内标题不能超过20个字符"):Promise.resolve()}],children:x.jsx(A,{placeholder:"若填写，将替换卡片名称显示",allowClear:!0,maxLength:20})}):null]}),x.jsx(V.Item,{label:"卡片大小",name:"size",className:"*:max-w-64",required:!0,rules:[{required:!0,message:"请选择卡片大小"}],children:x.jsx(R,{placeholder:"请选择卡片大小",options:D})}),x.jsx(V.Item,{label:"展示样式",name:"showType",required:!0,rules:[{required:!0,message:"请选择展示样式"}],children:x.jsxs(H.Group,{className:"ml-3",children:[x.jsx(H,{value:"icon",children:"纯图"}),x.jsx(H,{value:"text",children:"文本"}),x.jsx(H,{value:"icon-h",children:"横版"}),x.jsx(H,{value:"icon-v",children:"竖版"})]})}),x.jsx(V.Item,{label:"图标地址",name:"icon",required:!0,style:{display:"text"!==te?"":"none"},rules:[{validator:(e,a)=>"text"===te||a&&""!==a?a&&a.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve():Promise.reject("请获取或上传网站图标")}],children:x.jsx(A,{addonBefore:x.jsx(S,{title:"设为本地默认",destroyOnHidden:!0,children:x.jsx(j,{type:"text",className:"rounded-none",icon:x.jsx(U,{}),onClick:()=>{ee.setFieldValue("icon","/default/IeOutlined"),setTimeout((()=>{re(ee.getFieldsValue())}),0)}})}),placeholder:"请输入图标地址，默认安全链接（https://）",allowClear:!0,addonAfter:x.jsx(F,{disabled:!ne,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(n.error("图标大小不能超过200KB！"),!1):(g(0,ge),k({url:y.uploadIcon,token:ne,data:I({file:e})}).then((e=>{200===e.code&&e.data&&(ee.setFieldValue("icon",e.data.icon_url),ee.validateFields({dirty:!0}),re({...oe,icon:e.data.icon_url}))})).finally((()=>{v(0,ge)})),!1),children:x.jsx(j,{onClick:()=>{ne||n.error("请您先完成登录/注册")},loading:he[0],type:"text",className:"rounded-none",children:"上传",icon:x.jsx(M,{})})})})}),x.jsx(V.Item,{label:"文本内容",name:"text",style:{display:"text"!==te?"none":""},rules:[{validator:(e,a)=>a&&a.length>100?Promise.reject("文本内容不能超过20个字符"):Promise.resolve()}],children:x.jsx(A,{placeholder:"请输入文本内容",maxLength:20,allowClear:!0})}),x.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[x.jsx(V.Item,{label:"背景颜色",name:"backgroundColor",normalize:e=>e.toHexString(),children:x.jsx(E,{showText:!0})}),x.jsx(V.Item,{label:"文字颜色",normalize:e=>e.toHexString(),name:"fontColor",children:x.jsx(E,{showText:!0})})]}),x.jsx(T,{className:"mt-0 text-sm",children:"更多配置"}),x.jsxs("div",{className:"flex flex-wrap *:flex-1 gap-x-3",children:[x.jsx(V.Item,{label:"打开方式",name:"openTarget",required:!0,rules:[{required:!0,message:"请选择打开方式"}],children:x.jsx(R,{options:B,className:"max-w-32"})}),x.jsx(V.Item,{label:"图标内间距",name:"iconPadding",children:x.jsx(W,{min:0,max:48,precision:0,placeholder:"图标内间距"})})]}),x.jsx(V.Item,{className:"mb-16",label:"描述/备注",name:"description",rules:[{validator:(e,a)=>a&&a.length>255?Promise.reject("卡片描述/备注不能超过200个字符"):Promise.resolve()}],children:x.jsx(G,{autoSize:{minRows:2,maxRows:2},placeholder:"请输入卡片描述/备注",allowClear:!0,maxLength:200})}),x.jsxs("div",{className:"flex w-full justify-between flex-row-reverse gap-3 px-4 py-3 absolute left-0 bottom-0 z-10",style:{backgroundColor:ae.colorBgContainer,borderTop:`1px solid ${ae.colorBorderSecondary}`},children:[x.jsx(j,{onClick:()=>{X("save"),setTimeout((()=>{ee.submit()}),0)},type:"primary",children:"导入书签"}),$||!$&&!Y?x.jsx(R,{options:xe,value:pe,placeholder:"目标分组",className:"w-32 max-w-full",onChange:e=>{const a=K.findIndex((a=>a.id===e));ce&&(null==ce||ce.slideTo(a))}}):null]})]})]})})}export{Q as default};
