import{r as e,h as l,l as o,n as r,o as a,$ as s,a0 as i,v as t,j as d,c5 as n,U as c,B as m,m as x,q as u,ck as h,co as j,c as p,t as f,k as g}from"./requestIdleCallbackPolyfill-D8B_BKnT.js";import{u as b,F as C}from"./index-B2ixuohe.js";import{M as v}from"./myModal-DBZvI2Sk.js";import{I as y}from"./index-TisZiSXW.js";import{S as w}from"./index-D4WtNhOo.js";import{R as I}from"./CloudUploadOutlined-C9h1FgUY.js";import{C as k}from"./ColorPicker-CgJeeHlX.js";import{T as P}from"./index-DGmv9TK2.js";const{TextArea:N}=y;const S=e.memo(function(p){const{editItem:f,refresh:g,type:S="add"}=p,[q]=b(),[F,U]=e.useState([]),L=l(e=>e.stateUtils.categoryList).filter(e=>e&&0!==e.key).map(e=>({label:e.label,value:String(e.key)})),V=l(e=>e.user.token),z=l(e=>e.stateUtils.selectedCategoryId),[R,W]=e.useState(f),D=e.useCallback(e=>{o(1,U),r({url:"add"===S?a.submitWebsiteInfo:a.editWebsite,token:V,data:"add"===S?e:{...e,id:f.id}}).then(e=>{200===e.code&&("add"===S?(q.resetFields(),W(void 0)):s.hide(i),g&&g())}).finally(()=>{t(1,U)})},[]);return d.jsxs("main",{className:"mt-1",children:[d.jsx(T,{showItem:R}),d.jsxs(C,{labelCol:{flex:"82px"},form:q,initialValues:{backgroundColor:"#ffffff",fontColor:"#000000",...f,categoryId:"add"===S?"0"===z?void 0:z:String(null==f?void 0:f.categoryId)},onFinish:e=>{e.icon&&(e.icon=j(e.icon,"https://")),e.url&&(e.url=j(e.url,"https://")),n(e.url)?(e.categoryId=Number(e.categoryId),D(e)):x.error("请输入正确的网站地址")},onValuesChange:e=>{e.backgroundColor&&q.setFieldValue("fontColor",h(e.backgroundColor)),setTimeout(()=>{W(q.getFieldsValue())},0)},children:[d.jsx(C.Item,{label:"网站地址",required:!0,name:"url",rules:[{validator:(e,l)=>l&&""!==l?n(l)?l.length>200?Promise.reject("网站地址不能超过200个字符"):Promise.resolve():Promise.reject("请输入正确的网站地址"):Promise.reject("请输入网站地址")}],children:d.jsx(y,{placeholder:"网站地址",allowClear:!0,maxLength:512})}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx(C.Item,{name:"title",label:"网站标题",required:!0,rules:[{validator:(e,l)=>l&&""!==l?l.length>50?Promise.reject("网站标题不能超过50个字符"):Promise.resolve():Promise.reject("请输入网站标题")}],children:d.jsx(y,{placeholder:"网站标题",allowClear:!0,maxLength:50})}),d.jsx(C.Item,{label:"所属分类",required:!0,className:"w-[320px]",name:"categoryId",rules:[{required:!0,message:"请选择网站分类"}],children:d.jsx(w,{options:L,allowClear:!0,placeholder:"所属分类"})})]}),d.jsx(C.Item,{label:"网站描述",required:!0,name:"description",rules:[{validator:(e,l)=>l&&""!==l?l.length>200?Promise.reject("网站描述不能超过200个字符"):Promise.resolve():Promise.reject("请输入网站描述")}],children:d.jsx(N,{placeholder:"请简要的描述网站主要内容，用于详情展示",autoSize:{minRows:2,maxRows:2},showCount:!0,allowClear:!0,maxLength:200})}),d.jsx(C.Item,{label:"网站图标",required:!0,name:"icon",rules:[{validator:(e,l)=>l&&""!==l?l&&l.length>200?Promise.reject("网站图标不能超过200个字符"):Promise.resolve():Promise.reject("请输入或上传网站图标")}],children:d.jsx(y,{placeholder:"网站图标（注：透明背景图标最佳）",addonAfter:d.jsx(c,{disabled:!V,accept:".png, .jpg, .jpeg, .svg, .webp, .ico",showUploadList:!1,beforeUpload:e=>e.size>204800?(x.error("图标大小不能超过200KB！"),!1):(o(0,U),r({url:a.uploadWebsiteInfoIcon,token:V,data:u({file:e})}).then(e=>{200===e.code&&e.data&&(q.setFieldValue("icon",e.data.icon_url),q.validateFields({dirty:!0}),W({...R,icon:e.data.icon_url}))}).finally(()=>{t(0,U)}),!1),children:d.jsx(m,{onClick:()=>{V||x.error("请您先完成登录/注册")},loading:F[0],type:"text",className:"rounded-none",children:"上传",icon:d.jsx(I,{})})}),allowClear:!0})}),d.jsxs("div",{className:"flex flex-wrap *:flex-1",children:[d.jsx(C.Item,{label:"背景颜色",name:"backgroundColor",normalize:e=>e.toHexString(),children:d.jsx(k,{showText:!0})}),d.jsx(C.Item,{label:"文字颜色",normalize:e=>e.toHexString(),name:"fontColor",children:d.jsx(k,{showText:!0})})]}),g&&d.jsx(C.Item,{label:"排序",name:"sort",children:d.jsx(P,{placeholder:"排序",min:0})}),d.jsxs("div",{className:"flex justify-end gap-3 flex-wrap",children:[d.jsx(m,{onClick:()=>{s.hide(v)},children:"取消"}),d.jsx(m,{type:"primary",htmlType:"submit",loading:F[1],children:"add"===S?"提交":"保存"})]})]})]})}),T=e.memo(e=>{const l=p.c(8),{showItem:o}=e,{token:r}=f.useToken(),a=`${r.colorFillSecondary}`;let s,i,t;return l[0]!==a?(s={backgroundColor:a,borderRadius:"6px",maxWidth:"calc(100vw - 80px)"},l[0]=a,l[1]=s):s=l[1],l[2]!==o||l[3]!==r.colorTextDescription?(i=(null==o?void 0:o.icon)?d.jsx("div",{style:{backgroundColor:null==o?void 0:o.backgroundColor},className:"w-9 h-9 rounded-md overflow-hidden",children:d.jsx("img",{src:g(o.icon),alt:"",className:"w-full h-full"})}):d.jsx("p",{style:{color:r.colorTextDescription},className:"font-medium h-9 flex-center",children:"预览区域，等待图标配置"}),l[2]=o,l[3]=r.colorTextDescription,l[4]=i):i=l[4],l[5]!==s||l[6]!==i?(t=d.jsx("div",{style:s,className:"mb-6 p-4 flex-center overflow-hidden",children:i}),l[5]=s,l[6]=i,l[7]=t):t=l[7],t});export{S};
